@model List<WebPhongKham.Models.ViewModels.PhieuKhamViewModel>
@{
    Layout = "_Layout";
}

<div class="container mt-5" style="max-width: 760px;">
    <h3 class="text-center mb-4">üìã L·ªãch h·∫πn c·ªßa b·∫°n</h3>

    @if (Model == null || Model.Count == 0)
    {
        <div class="alert alert-info text-center">
            B·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o.
        </div>
    }
    else
    {
        <div class="list-group">
            @foreach (var lh in Model)
            {
                <div class="list-group-item shadow-sm mb-3 rounded">

                    <div class="d-flex justify-content-between align-items-start">

                        <div>
                            <div class="fw-bold text-primary">
                                üìÖ @lh.NgayKham.ToString("dd/MM/yyyy") - üïí @lh.GioKham.ToString(@"hh\:mm")

                            </div>

                            <div>
                                üë®‚Äç‚öïÔ∏è B√°c sƒ©: <b>@lh.TenBacSi</b>
                            </div>

                            <div class="mt-1">
                                Tr·∫°ng th√°i:
                                <span class="badge  text-white fw-semibold px-3 py-2
                                    @(lh.TrangThai=="ƒê√£ h·ªßy"?"bg-danger":
                                      lh.TrangThai=="ƒê√£ kh√°m"?"bg-success":
                                      "bg-warning text-dark")">
                                    @lh.TrangThai
                                </span>
                            </div>
                        </div>

                        <div class="text-end">
                            <a class="btn btn-outline-primary btn-sm mb-1"
                               href="/DatLich/PhieuKhamByMa?ma=@lh.PhieuKham">
                                Xem phi·∫øu
                            </a>

                            @if (lh.TrangThai == "ƒê√£ ƒë·∫∑t")
                            {
                                <button class="btn btn-outline-danger btn-sm"
                                        onclick="toggleHuy(@lh.IdLichHen)">
                                    H·ªßy l·ªãch
                                </button>
                            }
                        </div>
                    </div>

                    @if (lh.TrangThai == "ƒê√£ ƒë·∫∑t")
                    {
                        <form id="form-huy-@lh.IdLichHen"
                              asp-controller="BenhNhan"
                              asp-action="HuyLich"
                              method="post"
                              class="mt-3"
                              style="display:none;">

                            <input type="hidden" name="idLichHen" value="@lh.IdLichHen" />

                            <input type="text"
                                   name="lydo"
                                   class="form-control mb-2"
                                   placeholder="Nh·∫≠p l√Ω do h·ªßy l·ªãch..."
                                   required />

                            <button type="submit" class="btn btn-danger btn-sm">
                                X√°c nh·∫≠n h·ªßy
                            </button>
                        </form>
                    }
                </div>
            }
        </div>
    }
</div>

<script>
function toggleHuy(id) {
    const form = document.getElementById("form-huy-" + id);
    if (form) {
        form.style.display = form.style.display === "none" ? "block" : "none";
    }
}
</script>
